<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Forex with PG - Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');

    body {
      margin: 0;
      padding: 0;
      font-family: 'Montserrat', sans-serif;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: white;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .box {
      background-color: #1c1c1c;
      border-radius: 16px;
      padding: 30px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
      box-sizing: border-box;
    }

    h1, h2 {
      color: #ffd700;
      text-align: center;
      margin-top: 0;
    }

    button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      background: linear-gradient(to right, #ffd700, #ffb700);
      border: none;
      color: #111;
      font-weight: bold;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
    }

    input {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border-radius: 8px;
      border: none;
      background-color: #333;
      color: white;
      box-sizing: border-box;
      font-size: 14px;
    }

    #statusMsg, #loginStatus {
      color: #00ffcc;
      text-align: center;
      margin-top: 10px;
    }

    #menuBtn {
      position: fixed;
      top: 20px;
      right: 20px;
      background: none;
      border: none;
      color: white;
      font-size: 28px;
      cursor: pointer;
      user-select: none;
      z-index: 1000;
    }

    #profileMenu {
      position: fixed;
      top: 60px;
      right: 20px;
      background: #222;
      border: 1px solid #555;
      border-radius: 10px;
      padding: 10px;
      display: none;
      z-index: 1000;
      width: 220px;
      box-sizing: border-box;
    }

    #profileMenu p {
      margin: 8px 0;
      font-size: 14px;
      color: #ffd700;
      word-wrap: break-word;
    }

    ul {
      list-style: none;
      padding-left: 0;
      margin-top: 0;
    }

    ul#signalsList li {
      padding: 8px 12px;
      background: #2c5364;
      border-radius: 8px;
      margin-bottom: 8px;
      font-size: 15px;
      line-height: 1.3;
      color: #ffd700;
    }

    .login-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
  </style>
</head>
<body>
  <!-- 3-dot menu button -->
  <button id="menuBtn">â‹®</button>

  <!-- Profile menu shown on clicking 3-dot -->
  <div id="profileMenu">
    <p id="userEmail"></p>
    <p id="planInfo"></p>
    <button onclick="logout()">Logout</button>
  </div>

  <!-- Login Section -->
  <div class="box" id="loginSection">
    <h1>Login</h1>
    <div class="login-container">
      <input type="text" id="username" placeholder="Admin Username" autocomplete="off" />
      <input type="password" id="password" placeholder="Admin Password" autocomplete="off" />
      <button onclick="adminLogin()">Admin Login</button>
      <p id="loginStatus" style="color:#ff4444;"></p>
    </div>

    <hr style="border-color:#444; margin:20px 0;" />

    <button id="googleSignIn">Sign in with Google</button>
  </div>

  <!-- Signals Section for logged-in users -->
  <div class="box" id="signalsSection" style="display:none;">
    <h2>ðŸ“¢ Trade Signals</h2>
    <ul id="signalsList">
      <!-- signals loaded dynamically -->
    </ul>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCZGMG8iYHmmkY_MkuPggLDShD0aFqByQ0",
      authDomain: "signalapp-c5d0e.firebaseapp.com",
      projectId: "signalapp-c5d0e",
      storageBucket: "signalapp-c5d0e.appspot.com",
      messagingSenderId: "515390269998",
      appId: "1:515390269998:web:4231b1a25e611cfd978dbf",
      measurementId: "G-FF980DKDS2"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Admin credentials
    const ADMIN_USERNAME = 'mrpg0816';
    const ADMIN_PASSWORD = 'Pg@12341435';

    // Elements
    const loginSection = document.getElementById('loginSection');
    const signalsSection = document.getElementById('signalsSection');
    const signalsList = document.getElementById('signalsList');
    const loginStatus = document.getElementById('loginStatus');
    const menuBtn = document.getElementById('menuBtn');
    const profileMenu = document.getElementById('profileMenu');
    const userEmailEl = document.getElementById('userEmail');
    const planInfoEl = document.getElementById('planInfo');

    // Toggle 3-dot menu visibility
    menuBtn.onclick = () => {
      profileMenu.style.display = profileMenu.style.display === 'block' ? 'none' : 'block';
    };

    // Admin login function
    function adminLogin() {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();

      if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
        loginStatus.textContent = '';
        loginSection.style.display = 'none';
        signalsSection.style.display = 'block';
        menuBtn.style.display = 'block';
        profileMenu.style.display = 'none';

        userEmailEl.textContent = 'Admin: ' + username;
        planInfoEl.textContent = 'Full Access';

        loadStaticSignals();
      } else {
        loginStatus.textContent = 'Invalid admin username or password!';
      }
    }

    // Google Sign-In
    document.getElementById('googleSignIn').onclick = () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider).catch(e => {
        alert('Google sign-in error: ' + e.message);
      });
    };

    // Listen for Firebase auth state change (Google login)
    auth.onAuthStateChanged(async user => {
      if (user) {
        loginSection.style.display = 'none';
        signalsSection.style.display = 'block';
        menuBtn.style.display = 'block';
        profileMenu.style.display = 'none';

        userEmailEl.textContent = 'ðŸ‘¤ ' + user.email;
        planInfoEl.textContent = 'Google User';

        // Load signals from Firestore
        await loadFirestoreSignals();
      } else {
        // Logged out or no user
        loginSection.style.display = 'block';
        signalsSection.style.display = 'none';
        menuBtn.style.display = 'none';
        profileMenu.style.display = 'none';

        userEmailEl.textContent = '';
        planInfoEl.textContent = '';
      }
    });

    // Load static signals for admin (you can customize)
    function loadStaticSignals() {
      signalsList.innerHTML = `
        <li>Signal 1: Buy EUR/USD at 1.1050</li>
        <li>Signal 2: Sell GBP/USD at 1.2550</li>
        <li>Signal 3: Hold USD/JPY</li>
      `;
    }

    // Load signals from Firestore collection "signals"
    async function loadFirestoreSignals() {
      signalsList.innerHTML = '<li>Loading signals...</li>';
      try {
        const querySnapshot = await db.collection("signals").orderBy("timestamp", "desc").get();
        signalsList.innerHTML = '';
        if (querySnapshot.empty) {
          signalsList.innerHTML = '<li>No signals available.</li>';
          return;
        }
        querySnapshot.forEach(doc => {
          const li = document.createElement('li');
          li.textContent = doc.data().message || 'No message';
          signalsList.appendChild(li);
        });
      } catch (error) {
        signalsList.innerHTML = '<li>Error loading signals.</li>';
        console.error("Error fetching signals:", error);
      }
    }

    // Logout function for both admin and Google user
    function logout() {
      // If Firebase user exists, sign out Firebase
      if (auth.currentUser) {
        auth.signOut();
      }
      // Reset UI for admin logout
      loginSection.style.display = 'block';
      signalsSection.style.display = 'none';
      menuBtn.style.display = 'none';
      profileMenu.style.display = 'none';

      // Clear inputs and messages
      document.getElementById('username').value = '';
      document.getElementById('password').value = '';
      loginStatus.textContent = '';

      userEmailEl.textContent = '';
      planInfoEl.textContent = '';
    }
  </script>
</body>
</html>
